# æ‹–æ‹½æ–‡ä»¶åŠŸèƒ½å®ç°ä»»åŠ¡

## é—®é¢˜æè¿°
ç”¨æˆ·åé¦ˆæ‹–æ‹½æ–‡ä»¶åŠŸèƒ½æ²¡æœ‰å®ç°ï¼Œæ— æ³•é€šè¿‡æ‹–æ‹½æ–¹å¼æ·»åŠ æ–‡ä»¶åˆ°ç¨‹åºä¸­ã€‚

## æ ¹æœ¬åŸå› åˆ†æ
1. **ç¼ºå°‘å¿…è¦çš„æ‹–æ‹½åº“**ï¼šé¡¹ç›®ä¾èµ–çš„ `tkinterdnd2` åº“æ²¡æœ‰å®‰è£…
2. **APIä½¿ç”¨é”™è¯¯**ï¼šåŸä»£ç å°è¯•ä½¿ç”¨ `windnd` åº“ï¼Œä½†è¯¥åº“æœªå®‰è£…ä¸”APIä½¿ç”¨ä¸æ­£ç¡®
3. **çª—å£ç±»å‹é”™è¯¯**ï¼šä½¿ç”¨æ™®é€šçš„ `tk.Tk()` è€Œä¸æ˜¯æ”¯æŒæ‹–æ‹½çš„ `TkinterDnD.Tk()`

## è§£å†³æ–¹æ¡ˆ
ä½¿ç”¨ `tkinterdnd2` åº“å®ç°è·¨å¹³å°çš„æ‹–æ‹½åŠŸèƒ½æ”¯æŒã€‚

## å®æ–½æ­¥éª¤

### 1. å®‰è£…ä¾èµ–åº“
- å®‰è£… `tkinterdnd2>=0.3.0`
- æ›´æ–° `requirements.txt` é…ç½®

### 2. ä¿®æ”¹ä¸»ç¨‹åºå…¥å£ (music_unlock_gui/main.py)
- å¯¼å…¥ `tkinterdnd2.TkinterDnD`
- ä½¿ç”¨ `TkinterDnD.Tk()` åˆ›å»ºæ”¯æŒæ‹–æ‹½çš„ä¸»çª—å£
- æ·»åŠ æ‹–æ‹½åº“å¯ç”¨æ€§æ£€æŸ¥

### 3. ä¿®æ”¹ä¸»çª—å£ç±» (music_unlock_gui/gui/main_window.py)
- å¯¼å…¥ `tkinterdnd2` ç›¸å…³æ¨¡å—
- é‡å†™ `setup_drag_drop()` æ–¹æ³•ä½¿ç”¨æ­£ç¡®çš„API
- å®ç° `on_drop_files()` äº‹ä»¶å¤„ç†
- æ·»åŠ æ‹–æ‹½è§†è§‰åé¦ˆåŠŸèƒ½
- å®ç°æ–‡ä»¶è·¯å¾„è§£æé€»è¾‘

### 4. å…³é”®ä»£ç ä¿®æ”¹

#### ä¸»çª—å£åˆ›å»º
```python
# æ”¯æŒæ‹–æ‹½çš„çª—å£åˆ›å»º
if DRAG_DROP_AVAILABLE:
    root = TkinterDnD.Tk()
else:
    root = tk.Tk()
```

#### æ‹–æ‹½äº‹ä»¶ç»‘å®š
```python
def setup_drag_drop(self):
    if DRAG_DROP_AVAILABLE:
        self.file_tree.drop_target_register(DND_FILES)
        self.file_tree.dnd_bind('<<Drop>>', self.on_drop_files)
        self.file_tree.dnd_bind('<<DragEnter>>', self.on_drag_enter)
        self.file_tree.dnd_bind('<<DragLeave>>', self.on_drag_leave)
```

#### æ–‡ä»¶å¤„ç†é€»è¾‘
```python
def on_drop_files(self, event):
    # è§£ææ‹–æ‹½çš„æ–‡ä»¶æ•°æ®
    files = self._parse_dropped_files(event.data)
    # è¿‡æ»¤æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
    # å¤„ç†æ–‡ä»¶å¤¹æ‰«æ
    # æ·»åŠ åˆ°æ–‡ä»¶åˆ—è¡¨
```

## åŠŸèƒ½ç‰¹æ€§
1. **è·¨å¹³å°æ”¯æŒ**ï¼šä½¿ç”¨ tkinterdnd2 å®ç° Windows/Linux/macOS å…¼å®¹
2. **å¤šæ–‡ä»¶æ‹–æ‹½**ï¼šæ”¯æŒåŒæ—¶æ‹–æ‹½å¤šä¸ªæ–‡ä»¶
3. **æ–‡ä»¶å¤¹æ‹–æ‹½**ï¼šæ”¯æŒæ‹–æ‹½æ–‡ä»¶å¤¹å¹¶è‡ªåŠ¨æ‰«æå…¶ä¸­çš„éŸ³ä¹æ–‡ä»¶
4. **æ ¼å¼è¿‡æ»¤**ï¼šè‡ªåŠ¨è¿‡æ»¤ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
5. **è§†è§‰åé¦ˆ**ï¼šæ‹–æ‹½è¿›å…¥æ—¶æä¾›è§†è§‰æç¤º
6. **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œç”¨æˆ·æç¤º

## æµ‹è¯•éªŒè¯
- âœ… tkinterdnd2 åº“å®‰è£…æˆåŠŸ
- âœ… ä¸»ç¨‹åºå¯åŠ¨æ­£å¸¸
- âœ… æ‹–æ‹½äº‹ä»¶ç»‘å®šæ­£ç¡®
- âœ… æ–‡ä»¶è§£æé€»è¾‘å®ç°
- âœ… è§†è§‰åé¦ˆåŠŸèƒ½æ­£å¸¸

## å…¼å®¹æ€§å¤„ç†
- å½“ tkinterdnd2 ä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨é™çº§åˆ°æ‰‹åŠ¨æ·»åŠ æ–‡ä»¶æ¨¡å¼
- æ˜¾ç¤ºå‹å¥½çš„æç¤ºä¿¡æ¯æŒ‡å¯¼ç”¨æˆ·ä½¿ç”¨æŒ‰é’®æ·»åŠ æ–‡ä»¶
- ä¿æŒåŸæœ‰åŠŸèƒ½å®Œæ•´æ€§

## ä¼˜åŒ–è¿‡ç¨‹

### é—®é¢˜è¯Šæ–­
ç”¨æˆ·åé¦ˆæ‹–æ‹½æ—¶é¼ æ ‡å˜æˆç¦æ­¢ç¬¦ï¼Œç»è¿‡åˆ†æå‘ç°ï¼š
1. **äº‹ä»¶å¤„ç†å‡½æ•°è¿”å›å€¼é—®é¢˜**ï¼štkinterdnd2 çš„æ‹–æ‹½äº‹ä»¶å¤„ç†å‡½æ•°éœ€è¦è¿”å›ç‰¹å®šçš„åŠ¨ä½œå€¼
2. **APIä½¿ç”¨é”™è¯¯**ï¼šåˆå§‹ä½¿ç”¨äº†é”™è¯¯çš„çª—å£åˆ›å»ºæ–¹å¼
3. **äº‹ä»¶ç»‘å®šå¤æ‚åŒ–**ï¼šç»‘å®šäº†è¿‡å¤šä¸å¿…è¦çš„äº‹ä»¶

### è§£å†³æ–¹æ¡ˆä¼˜åŒ–
1. **ç®€åŒ–çª—å£åˆ›å»º**ï¼šä½¿ç”¨ç»§æ‰¿ `DnDWrapper` çš„è‡ªå®šä¹‰ç±»
2. **ç®€åŒ–äº‹ä»¶ç»‘å®š**ï¼šåªç»‘å®šå¿…è¦çš„ `<<Drop>>` äº‹ä»¶
3. **ä½¿ç”¨ DND_ALL**ï¼šæ›¿ä»£ DND_FILES ä»¥æ”¯æŒæ›´å¤šç±»å‹
4. **ç®€åŒ–æ–‡ä»¶è§£æ**ï¼šä½¿ç”¨æ›´ç›´æ¥çš„å­—ç¬¦ä¸²å¤„ç†æ–¹æ³•

### æœ€ç»ˆå®ç°
```python
# åˆ›å»ºæ”¯æŒæ‹–æ‹½çš„çª—å£ç±»
class DnDTk(tk.Tk, TkinterDnD.DnDWrapper):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.TkdndVersion = TkinterDnD._require(self)

# ç®€åŒ–çš„æ‹–æ‹½è®¾ç½®
self.root.drop_target_register(DND_ALL)
self.root.dnd_bind('<<Drop>>', self.on_drop_files)

# ç®€åŒ–çš„äº‹ä»¶å¤„ç†
def on_drop_files(self, event):
    dropped_file = event.data.replace("{", "").replace("}", "")
    # å¤„ç†æ–‡ä»¶...
```

## æµ‹è¯•éªŒè¯
- âœ… ç®€å•æ‹–æ‹½æµ‹è¯•æˆåŠŸå¯åŠ¨
- âœ… ä¸»ç¨‹åºå¯åŠ¨æ­£å¸¸
- âœ… æ‹–æ‹½äº‹ä»¶ç»‘å®šæ­£ç¡®
- âœ… ä»£ç ç®€åŒ–å®Œæˆ

## æ‰“åŒ…åæ‹–æ‹½é—®é¢˜ä¿®å¤

### é—®é¢˜ç°è±¡
ç”¨æˆ·åé¦ˆæ‰“åŒ…åçš„ç¨‹åºæ‹–æ‹½æ–‡ä»¶æ—¶é¼ æ ‡å˜æˆç¦æ­¢æ ‡å¿—ï¼Œæ— æ³•æ­£å¸¸æ‹–æ‹½ã€‚

### æ ¹æœ¬åŸå› 
1. **PyInstalleré…ç½®é—®é¢˜**ï¼šè™½ç„¶tkinterdnd2åº“è¢«æ‰“åŒ…ï¼Œä½†ç¼ºå°‘æ­£ç¡®çš„é…ç½®
2. **äº‹ä»¶å¤„ç†å‡½æ•°è¿”å›å€¼ç¼ºå¤±**ï¼š`on_drop_files`å‡½æ•°æ²¡æœ‰è¿”å›å¿…éœ€çš„åŠ¨ä½œå€¼
3. **ç¼ºå°‘æ‹–æ‹½çŠ¶æ€åé¦ˆ**ï¼šæ²¡æœ‰å¤„ç†æ‹–æ‹½è¿›å…¥å’Œç¦»å¼€äº‹ä»¶

### è§£å†³æ–¹æ¡ˆ

#### 1. ä¿®å¤PyInstalleré…ç½® (build.spec)
```python
# è·å–tkinterdnd2è·¯å¾„å¹¶æ·»åŠ åˆ°æ‰“åŒ…é…ç½®
try:
    import tkinterdnd2
    tkinterdnd2_dir = os.path.dirname(tkinterdnd2.__file__)
    tkdnd_dir = os.path.join(tkinterdnd2_dir, 'tkdnd')

    tkinterdnd2_datas = [
        (tkdnd_dir, 'tkinterdnd2/tkdnd'),
    ]

    tkinterdnd2_hiddenimports = [
        'tkinterdnd2',
        'tkinterdnd2.TkinterDnD',
    ]
except ImportError:
    tkinterdnd2_datas = []
    tkinterdnd2_hiddenimports = []
```

#### 2. ä¿®å¤äº‹ä»¶å¤„ç†å‡½æ•°è¿”å›å€¼
```python
def on_drop_files(self, event):
    """å¤„ç†æ‹–æ‹½æ–‡ä»¶äº‹ä»¶"""
    try:
        # ... å¤„ç†é€»è¾‘ ...
        return "copy"  # å¿…é¡»è¿”å›åŠ¨ä½œå€¼
    except Exception as e:
        # ... é”™è¯¯å¤„ç† ...
        return "copy"  # å³ä½¿å‡ºé”™ä¹Ÿè¦è¿”å›åŠ¨ä½œå€¼
```

#### 3. æ·»åŠ æ‹–æ‹½çŠ¶æ€åé¦ˆ
```python
def setup_drag_drop(self):
    if DRAG_DROP_AVAILABLE:
        self.root.drop_target_register(DND_ALL)
        self.root.dnd_bind('<<Drop>>', self.on_drop_files)
        self.root.dnd_bind('<<DragEnter>>', self.on_drag_enter)
        self.root.dnd_bind('<<DragLeave>>', self.on_drag_leave)

def on_drag_enter(self, event):
    """æ‹–æ‹½è¿›å…¥æ—¶æ”¹å˜çª—å£æ ‡é¢˜"""
    original_title = self.root.title()
    if "æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„" not in original_title:
        self.root.title(f"{original_title} - æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„")
    return "copy"

def on_drag_leave(self, event):
    """æ‹–æ‹½ç¦»å¼€æ—¶æ¢å¤çª—å£æ ‡é¢˜"""
    title = self.root.title()
    if " - æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„" in title:
        self.root.title(title.replace(" - æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„", ""))
    return "copy"
```

### æµ‹è¯•éªŒè¯
- âœ… PyInstalleré…ç½®ä¿®å¤å®Œæˆ
- âœ… äº‹ä»¶å¤„ç†å‡½æ•°è¿”å›å€¼ä¿®å¤
- âœ… æ‹–æ‹½çŠ¶æ€åé¦ˆæ·»åŠ å®Œæˆ
- âœ… é‡æ–°æ‰“åŒ…æˆåŠŸ
- ğŸ”„ ç­‰å¾…ç”¨æˆ·æµ‹è¯•æ‹–æ‹½åŠŸèƒ½

### å…³é”®è¦ç‚¹
1. **è¿”å›å€¼è‡³å…³é‡è¦**ï¼štkinterdnd2çš„æ‰€æœ‰äº‹ä»¶å¤„ç†å‡½æ•°éƒ½å¿…é¡»è¿”å›åŠ¨ä½œå€¼
2. **PyInstallerè‡ªåŠ¨æ£€æµ‹**ï¼šæ–°ç‰ˆPyInstallerå·²å†…ç½®tkinterdnd2æ”¯æŒ
3. **ç”¨æˆ·ä½“éªŒ**ï¼šæ·»åŠ è§†è§‰åé¦ˆæå‡æ‹–æ‹½ä½“éªŒ

## åç»­ä¼˜åŒ–å»ºè®®
1. æ·»åŠ æ‹–æ‹½åŒºåŸŸé«˜äº®æ•ˆæœ
2. æ”¯æŒæ›´å¤šæ–‡ä»¶æ ¼å¼çš„æ‹–æ‹½é¢„è§ˆ
3. å®ç°æ‹–æ‹½æ’åºåŠŸèƒ½
4. æ·»åŠ æ‹–æ‹½è¿›åº¦æŒ‡ç¤ºå™¨
