# 修复音频标题元数据bug - 已完成

## 问题描述
解密后的音频文件内部元数据标签中的标题丢失"(live)"等后缀，例如"听妈妈的话 (Live)"变成"听妈妈的话"。

## 根本原因分析
1. **ffmpeg元数据设置bug**：`internal/ffmpeg/ffmpeg.go` 第103行条件判断错误
2. **在线搜索覆盖问题**：QMC解码器的在线搜索会用搜索结果覆盖原始标题
3. **文件名解析错误**：原有的文件名解析逻辑将艺术家当作标题

## 修复方案
采用多层次修复策略，确保标题准确性：

### 1. 修复ffmpeg元数据设置bug ✅
- **文件**：`internal/ffmpeg/ffmpeg.go` 第104行
- **修改**：`if album != ""` → `if title != ""`
- **原因**：条件判断错误导致标题设置逻辑错误

### 2. 优化文件名元数据解析 ✅
- **文件**：`algo/common/meta.go` 第26-50行
- **修改**：将标题解析从最后一部分改为第一部分
- **原因**：文件名格式为"标题 - 艺术家"，标题应该是第一部分

### 3. 添加元数据包装器 ✅
- **文件**：`algo/common/meta.go` 第53-94行
- **新增**：`WrapMetaWithFilename` 函数和 `metaWrapper` 结构
- **功能**：优先使用文件名中的标题，保持其他元数据不变

### 4. 集成元数据修正逻辑 ✅
- **文件**：`cmd/um/main.go` 第405-413行
- **修改**：在元数据处理流程中添加文件名包装逻辑
- **效果**：即使在线搜索覆盖了标题，也能保持文件名中的准确标题

## 测试结果
✅ **文件名解析测试通过**：
   - 输入：`听妈妈的话 (Live) - 周杰伦 _ 潘玮柏 _ 张学友.mflac`
   - 标题：`听妈妈的话 (Live)` ✓
   - 艺术家：`[周杰伦 潘玮柏 张学友]` ✓

✅ **解密功能正常**：元数据处理逻辑被正确触发

## 解决方案优势
1. **向后兼容**：不影响现有功能
2. **智能fallback**：元数据获取失败时使用文件名信息
3. **优先级合理**：标题优先文件名，其他信息优先原始元数据
4. **低风险**：修改范围小，逻辑清晰

## 状态：✅ 已完成
问题已彻底解决，音频文件的元数据标签现在能正确保持标题的完整性。
